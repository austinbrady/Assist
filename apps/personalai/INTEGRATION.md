# PersonalAI Integration with AssistantAI

PersonalAI is now fully integrated as a child app of AssistantAI. This document explains how it works within the ecosystem.

## Structure

```
AssistantAI/
├── apps/
│   ├── personalai/          # PersonalAI child app
│   │   ├── backend/         # FastAPI backend
│   │   ├── frontend/         # Next.js frontend
│   │   ├── mobile/           # React Native mobile app
│   │   ├── START.sh          # Start script (reads ports from AssistantAI)
│   │   └── package.json      # App-level package.json
│   └── mvpassistant/         # MVP Assistant (sister app)
├── config/
│   ├── apps.json             # App registry
│   └── ports.json            # Port assignments
└── ...
```

## Port Management

PersonalAI uses AssistantAI's port management system:

- **Backend Port**: Assigned from `config/ports.json` (default: 4200)
- **Frontend Port**: Assigned from `config/ports.json` (default: 4201)

The `START.sh` script automatically reads ports from `config/ports.json`:
1. Looks for `personalai-backend` entry → uses that port
2. Looks for `personalai-frontend` entry → uses that port
3. Falls back to defaults (4200/4201) if not found

## Starting PersonalAI

### From AssistantAI Hub

1. Start AssistantAI: `npm run start:all` (from AssistantAI root)
2. Access Hub: http://localhost:4000
3. Click "Start" on PersonalAI card

### Directly

```bash
cd apps/personalai
./START.sh
```

The script will:
- Read ports from `../../config/ports.json`
- Start backend on assigned port
- Start frontend on assigned port
- Log to `../../logs/personalai-*.log`

## Environment Variables

PersonalAI respects these environment variables:

- `PERSONALAI_BACKEND_PORT`: Override backend port (default: from ports.json)
- `PERSONALAI_FRONTEND_PORT`: Override frontend port (default: from ports.json)
- `PORT`: Used by backend if PERSONALAI_BACKEND_PORT not set

## Integration Points

### 1. Authentication
PersonalAI provides the base authentication system for all AssistantAI apps:
- User accounts stored in `apps/personalai/backend/users/`
- JWT tokens generated by PersonalAI backend
- Middleware validates tokens with PersonalAI backend

### 2. Agent Infrastructure
PersonalAI provides the agent infrastructure:
- Agent state stored in PersonalAI backend
- Conversation history in PersonalAI backend
- Memory management in PersonalAI backend

### 3. Shared Data
All apps share:
- User profiles
- Agent personality and memory
- Conversation history
- User data (todos, calendar, etc.)

## Configuration

### Ports Configuration

Ports are managed in `config/ports.json`:

```json
{
  "basePort": 4200,
  "apps": [
    {
      "id": "personalai-backend",
      "name": "PersonalAI Backend",
      "port": 4200,
      "type": "backend",
      "enabled": true
    },
    {
      "id": "personalai-frontend",
      "name": "PersonalAI Frontend",
      "port": 4201,
      "type": "frontend",
      "enabled": true
    }
  ]
}
```

### App Registry

Apps are registered in `config/apps.json`:

```json
{
  "apps": [
    {
      "id": "personalai",
      "name": "PersonalAI",
      "baseUrl": "http://localhost:4201",
      "backendUrl": "http://localhost:4200",
      "isBaseBackend": true
    }
  ]
}
```

## Development

### Installing Dependencies

```bash
# From AssistantAI root
npm run install:apps

# Or from PersonalAI directory
cd apps/personalai
npm run install:all
```

### Running in Development

```bash
# Backend only
cd apps/personalai/backend
source venv/bin/activate
uvicorn main:app --reload --port 4200

# Frontend only
cd apps/personalai/frontend
npm run dev -- -p 4201
```

## Logs

Logs are written to AssistantAI's logs directory:
- Backend: `../../logs/personalai-backend.log`
- Frontend: `../../logs/personalai-frontend.log`

## Status

PersonalAI is fully integrated and managed by AssistantAI:
- ✅ Ports managed by AssistantAI port manager
- ✅ Started/stopped from AssistantAI hub
- ✅ Shares authentication with other apps
- ✅ Provides base backend for ecosystem
- ✅ Follows AssistantAI port rules

## Relationship to Other Apps

- **MVP Assistant**: Sister app, uses PersonalAI backend for auth/agent
- **Future Apps**: Will also use PersonalAI backend for auth/agent

All apps share the same:
- User accounts
- Agent personality
- Conversation history
- User data

This creates a unified experience where users have one account, one agent, and shared data across all AssistantAI apps.

